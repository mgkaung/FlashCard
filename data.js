// data.js

const ocr_text = `
3
Lernwortschatz
eine Stadttour
der Mensch, -en
das Haus, "er
das Rathaus, "er
das Konzerthaus, "er
die Kirche, -n
das Fahrrad, er
der Bus, -se
die Straßenbahn, -en
der Zug, e
die U-Bahn, -en
die S-Bahn, -en
das Schiff, -e
der Turm, e
das Hotel, -s
die Brücke, -n
der Park, -s
der Markt, e
der Bahnhof, e
der Hafen, -
der See, -n
der Fluss, e
das Meer, -e
sehen, er sieht (Da sieht
man den Hafen.)
da (Da ist das Hotel.)
Das ist ...
interessant
schön
die Station, -en
der Ort, -e
Maße angeben
der Meter, -
der Kilometer, -
lang (Die Brücke ist
12 Kilometer lang.)
breit (Das Rathaus ist
111 Meter breit.)
hoch (Der Turm ist
132 Meter hoch.)
über (Das Haus ist über
100 Jahre alt.)
die Kosten (PL.)
das Flugzeug, -e
die Fahrkarte, -n
schnell
nach (Der Zug fährt nach
Berlin.)
einen Weg beschreiben
der Weg, -e
Wo ist bitte ...?
Das ist ganz einfach.
rechts
links
geradeaus
Gehen Sie zuerst rechts
und dann geradeaus.
richtig (Ist das richtig?)
genau (Ja, genau!)
die Mitte (Sg.)
Wo ist das? - Genau in der
Mitte.
also (Also, zuerst links
und ...)
zeigen
der Plan, e
zeichnen
der Start (Sg.)
das Ziel, -e
schon (Da ist schon das
Hotel.)
der Euro, -s
Verkehrsmittel
zu Fuß gehen
112 einhundertzwölf
Events
das Event, -s
das Festival, -s
das Ticket, -s
das Publikum (Sg.)
der Besucher, -
die Besucherin, -nen
der Gast, e
das Konzert, -e
das Orchester, -
der Chor, e
die Konzertkarte, -n
der Film, -e
der Schauspieler, -
die Schauspielerin, -nen
der Star, -s
der Regisseur, -e
die Regisseurin, -nen
die Ausstellung, -en
finden
Findest du das Konzert
gut?
Jahreszeiten
die Jahreszeit, -en
der Frühling
der Sommer
der Herbst
der Winter
Monate
der Monat, -e
der Januar
der Februar
der März
der April
der Mai
der Juni
der Juli
der August
der September
der Oktober
der November
der Dezember
andere wichtige Wörter und Wendungen
die Gruppe, -n
das Bild, -er
das Plakat, -e
das Glück (Sg.)
so (So ein Glück!)
der Test, -s
heute (Heute ist kein Test!)
jetzt (Jetzt aber schnell!)
okay
die Welt, -en
die Lösung, -en
ein Mal, zwei Mal, ...
das erste/zweite/... Mal
Vielen Dank!
Wichtig für mich:
Welche Verkehrsmittel benutzen Sie? Notieren Sie.
Wie heißen die Wörter? Schreiben Sie die Wörter mit Artikel.
1. Park
4. Fluss
5. maus
2. IνιαΓκι
3. втиске
6. GLUCK
einhundertdreizehn 113
4
Lernwortschatz
Lebensmittel
Obst
das Obst (Sg.)
der Apfel, "
die Banane, -n
die Birne, -n
Gemüse
das Gemüse (Sg.)
die Gurke, -n
die Kartoffel, -n
der Salat, -e
die Tomate, -n
die Olive, -n
die Zwiebel, -n
Backwaren
das Brot, -e
das Brötchen, -
der Keks, -e
der Kuchen, -
Fleischprodukte
das Fleisch (Sg.)
der Fisch, -e
die Schokolade, -n
die Marmelade, -n
das Müsli, -s
Getränke
das Getränk, -e
das Wasser, -
der Saft, e
die Limonade, -n
die Cola, -s
der Kaffee, -s
der Tee, -s
Geschäfte
die Bäckerei, -en
der Markt, =
die Metzgerei, -en
der Supermarkt, e
Packungen und Maße
das Hähnchen, -
die Packung, -en
der Schinken, -
der Becher, -
die Wurst, e
die Dose, -n
das Würstchen, -
das Stück, -e
Milchprodukte
die Tüte, -n
die Butter (Sg.)
das Gramm (g)
der/das Joghurt, -s
das Kilo(gramm) (kg)
der Käse (Sg.)
der Liter (l)
die Milch (Sg.)
die Sahne (Sg.)
andere Lebensmittel
der Pfeffer (Sg.)
das Salz, -e
der Zucker (Sg.)
der Essig, -e
das Öl, -e
die Nudel, -n
der Reis (Sg.)
das Ei, -er
128 einhundertachtundzwanzig
beim Einkaufen
kaufen
ein kaufen
der Einkaufswagen, -
brauchen
möchten, er möchte
finden
Entschuldigung, wo finde
ich ...?
Wo gibt es ...?
kosten
der Preis, -e
Das macht ... Euro, bitte.
der Kassenzettel, -
teuer
wechseln
Können Sie wechseln,
bitte?
beim Essen
Guten Appetit!
Danke, gleichfalls.
das Essen, -
essen, er isst
trinken
fertig (Das Essen ist gleich
fertig.)
mögen, er mag
nehmen, er nimmt
schmecken (Schmeckt's?)
lecker
süß
frisch
Mahlzeiten
das Frühstück, -e
frühstücken
das Mittagessen, -
das Abendessen, -
Gerichte
das Gericht, -e
die Suppe, -n
die Pizza, -s/Pizzen
die Pommes frites (Pl.)
Tageszeiten
der Morgen, -
morgens
der Mittag, -e
mittags
der Nachmittag, -e
nachmittags
der Abend, -e
abends
die Nacht, "e
nachts
andere wichtige Wörter und Wendungen
die Einladung, -en
nett
gesund
waschen, er wäscht
schneiden
grillen
probieren
die Kantine, -n
wenig
vielleicht
wichtig
Wichtig für mich:
Schreiben Sie einen Einkaufszettel für ein Grillfest mit Freunden.
Salat, ...
...
Welche Lebensmittel, Gerichte und Getränke mögen Sie? Markieren Sie in der Liste.
`;

const GERMAN_TO_ENGLISH = {
    "Mensch": "person, human being", "Haus": "house", "Rathaus": "town hall, city hall",
    "Konzerthaus": "concert hall", "Kirche": "church", "Fahrrad": "bicycle", "Bus": "bus",
    "Straßenbahn": "tram, streetcar", "Zug": "train", "U-Bahn": "subway, underground",
    "S-Bahn": "suburban train", "Schiff": "ship, boat", "Turm": "tower", "Hotel": "hotel",
    "Brücke": "bridge", "Park": "park", "Markt": "market", "Bahnhof": "train station",
    "Hafen": "harbor, port", "See": "lake (der See); sea (die See)", "Fluss": "river",
    "Meer": "sea, ocean", "Station": "station", "Ort": "place, location, town",
    "Meter": "meter", "Kilometer": "kilometer", "Kosten": "costs, expenses",
    "Flugzeug": "airplane", "Fahrkarte": "ticket (for transport)", "Weg": "way, path, route",
    "Mitte": "middle, center", "Plan": "plan, map, schedule", "Start": "start",
    "Ziel": "goal, destination, target", "Euro": "Euro", "Event": "event",
    "Festival": "festival", "Ticket": "ticket (for event)", "Publikum": "audience, public",
    "Besucher": "visitor (male)", "Besucherin": "visitor (female)", "Gast": "guest",
    "Konzert": "concert", "Orchester": "orchestra", "Chor": "choir",
    "Konzertkarte": "concert ticket", "Film": "film, movie", "Schauspieler": "actor",
    "Schauspielerin": "actress", "Star": "star (celebrity)",
    "Regisseur": "director (film/theatre, male)", "Regisseurin": "director (film/theatre, female)",
    "Ausstellung": "exhibition", "Jahreszeit": "season (of the year)", "Frühling": "spring",
    "Sommer": "summer", "Herbst": "autumn, fall", "Winter": "winter", "Monat": "month",
    "Januar": "January", "Februar": "February", "März": "March", "April": "April",
    "Mai": "May", "Juni": "June", "Juli": "July", "August": "August",
    "September": "September", "Oktober": "October", "November": "November",
    "Dezember": "December", "Gruppe": "group", "Bild": "picture, image, painting",
    "Plakat": "poster", "Glück": "luck, happiness", "Test": "test", "Welt": "world",
    "Lösung": "solution, answer", "Obst": "fruit (collective)", "Apfel": "apple",
    "Banane": "banana", "Birne": "pear", "Gemüse": "vegetables (collective)",
    "Gurke": "cucumber", "Kartoffel": "potato", "Salat": "salad; lettuce",
    "Tomate": "tomato", "Olive": "olive", "Zwiebel": "onion", "Brot": "bread",
    "Brötchen": "bread roll", "Keks": "cookie, biscuit", "Kuchen": "cake, pie",
    "Fleisch": "meat", "Fisch": "fish", "Schokolade": "chocolate",
    "Marmelade": "jam, marmalade", "Müsli": "muesli, granola", "Getränk": "drink, beverage",
    "Wasser": "water", "Saft": "juice", "Limonade": "lemonade, soda", "Cola": "cola",
    "Kaffee": "coffee", "Tee": "tea", "Bäckerei": "bakery", "Metzgerei": "butcher shop",
    "Supermarkt": "supermarket", "Hähnchen": "chicken (food)", "Packung": "package, pack",
    "Schinken": "ham", "Becher": "cup, beaker, pot (e.g. yogurt pot)", "Wurst": "sausage",
    "Dose": "can, tin", "Würstchen": "small sausage, wiener", "Stück": "piece, bit; play (theatre)",
    "Butter": "butter", "Tüte": "bag (paper/plastic)", "Joghurt": "yogurt",
    "Gramm": "gram", "Käse": "cheese", "Kilo": "kilo, kilogram", "Milch": "milk",
    "Liter": "liter", "Sahne": "cream", "Pfeffer": "pepper (spice)", "Salz": "salt",
    "Zucker": "sugar", "Essig": "vinegar", "Öl": "oil", "Nudel": "noodle, pasta",
    "Reis": "rice", "Ei": "egg", "Einkaufswagen": "shopping cart", "Preis": "price; prize",
    "Kassenzettel": "receipt (from store)", "Essen": "food; meal; act of eating",
    "Frühstück": "breakfast", "Mittagessen": "lunch", "Abendessen": "dinner, supper",
    "Gericht": "dish (food); court (law)", "Suppe": "soup", "Pizza": "pizza",
    "Pommes frites": "french fries", "Morgen": "morning; tomorrow", "Mittag": "midday, noon",
    "Nachmittag": "afternoon", "Abend": "evening", "Nacht": "night",
    "Einladung": "invitation", "Kantine": "canteen, cafeteria"
    // REVIEW AND COMPLETE THIS DICTIONARY!
};

const NOUN_TO_EMOJI = {
    "Mensch": "🧑", "Haus": "🏠", "Rathaus": "🏛️", "Konzerthaus": "🎶", "Kirche": "⛪",
    "Fahrrad": "🚲", "Bus": "🚌", "Straßenbahn": "🚋", "Zug": "🚂", "U-Bahn": "🚇",
    "S-Bahn": "🚆", "Schiff": "🚢", "Turm": "🗼", "Hotel": "🏨", "Brücke": "🌉",
    "Park": "🏞️", "Markt": "🛒", "Bahnhof": "🚉", "Hafen": "⚓", "See": "🌊",
    "Fluss": "🏞️", "Meer": "🌊", "Station": "🚉", "Ort": "📍",
    "Meter": "📏", "Kilometer": "🛣️",
    "Kosten": "💰", "Flugzeug": "✈️", "Fahrkarte": "🎟️", "Weg": "🛣️",
    "Mitte": "🎯", "Plan": "🗺️", "Start": "🏁", "Ziel": "🎯", "Euro": "💶",
    "Event": "🎉", "Festival": "🎉", "Ticket": "🎟️",
    "Publikum": "👥", "Besucher": "🚶", "Besucherin": "🚶‍♀️", "Gast": "👋",
    "Konzert": "🎵", "Orchester": "🎻", "Chor": "🎤", "Konzertkarte": "🎟️",
    "Film": "🎬", "Schauspieler": "🎭", "Schauspielerin": "🎭", "Star": "🌟",
    "Regisseur": "🎬", "Regisseurin": "🎬", "Ausstellung": "🖼️",
    "Jahreszeit": "📅", "Frühling": "🌸", "Sommer": "☀️", "Herbst": "🍂", "Winter": "❄️",
    "Monat": "📅", "Januar": "❄️", "Februar": "⛄", "März": "🌷", "April": "🌧️",
    "Mai": "🌼", "Juni": "☀️", "Juli": "🏖️", "August": "🌞",
    "September": "🍁", "Oktober": "🎃", "November": "🌬️", "Dezember": "🎄",
    "Gruppe": "👥", "Bild": "🖼️", "Plakat": "📰", "Glück": "🍀", "Test": "📝",
    "Welt": "🌍", "Lösung": "💡",
    "Obst": "🍓", "Apfel": "🍎", "Banane": "🍌", "Birne": "🍐",
    "Gemüse": "🥕", "Gurke": "🥒", "Kartoffel": "🥔", "Salat": "🥗",
    "Tomate": "🍅", "Olive": "🫒", "Zwiebel": "🧅",
    "Brot": "🍞", "Brötchen": "🥖", "Keks": "🍪", "Kuchen": "🍰",
    "Fleisch": "🥩", "Fisch": "🐟", "Schokolade": "🍫", "Marmelade": "🍓",
    "Müsli": "🥣", "Getränk": "🥤", "Wasser": "💧", "Saft": "🧃",
    "Limonade": "🥤", "Cola": "🥤", "Kaffee": "☕", "Tee": "🍵",
    "Bäckerei": "🥐", "Metzgerei": "🍖", "Supermarkt": "🏪",
    "Hähnchen": "🍗", "Packung": "📦", "Schinken": "🥓", "Becher": "🥛",
    "Wurst": "🌭", "Dose": "🥫", "Würstchen": "🌭", "Stück": "🧩",
    "Butter": "🧈", "Tüte": "🛍️", "Joghurt": "🍦",
    "Gramm": "⚖️", "Käse": "🧀", "Kilo": "⚖️", "Milch": "🥛", "Liter": "💧",
    "Sahne": "🍦",
    "Pfeffer": "🌶️", "Salz": "🧂", "Zucker": "🍬", "Essig": "🍾", "Öl": "🫒",
    "Nudel": "🍜", "Reis": "🍚", "Ei": "🥚",
    "Einkaufswagen": "🛒", "Preis": "💲", "Kassenzettel": "🧾",
    "Essen": "🍽️", "Frühstück": "🥞", "Mittagessen": "🥪", "Abendessen": "🍝",
    "Gericht": "🍲", "Suppe": "🥣", "Pizza": "🍕", "Pommes frites": "🍟",
    "Morgen": "🌅", "Mittag": "☀️", "Nachmittag": "🌇", "Abend": "🌃", "Nacht": "🌙",
    "Einladung": "✉️", "Kantine": "🍽️"
    // REVIEW AND COMPLETE THIS DICTIONARY!
};


function parseOcrToFlashcards(text) {
    const flashcards = [];
    const lines = text.split('\n');
    const articleRegex = /^(der|die|das|der\/das)\s+([A-ZÖÄÜ][a-zA-Zöäüß]+.*?)(?:,\s*(.*?))?$/;
    const noCommaPluralRegex = /^(der|die|das|der\/das)\s+([A-ZÖÄÜ][a-zA-Zöäüß]+)\s+\((PL\.|Sg\.)\)/;

    for (const line of lines) {
        const trimmedLine = line.trim();
        if (!trimmedLine) continue;

        let article, nounPartWithDetails, pluralPartRaw;
        let match = trimmedLine.match(articleRegex);

        if (match) {
            article = match[1];
            nounPartWithDetails = match[2].trim(); // This is the part after the article, up to the comma
            pluralPartRaw = match[3] ? match[3].trim() : null;
        } else {
            match = trimmedLine.match(noCommaPluralRegex);
            if (match) {
                article = match[1];
                // Reconstruct nounPartWithDetails to include the (Sg.) or (Pl.) tag for consistency
                nounPartWithDetails = `${match[2].trim()} (${match[3]})`;
                pluralPartRaw = null; // Plural info is now part of nounPartWithDetails
            } else {
                continue; // Not a noun line we can parse in either format
            }
        }

        // Clean noun_base: remove (Sg.), (Pl.), (g), (kg), (l) from the end
        let nounBase = nounPartWithDetails.replace(/\s*\((Sg\.|Pl\.|g|kg|l|PL\.)\)$/, '').trim();
        // Second pass if the tag was not at the very end but part of nounPartWithDetails from noCommaPluralRegex
        nounBase = nounBase.replace(/\s*\((Sg\.|Pl\.|PL\.)\)$/, '').trim();


        let pluralDisplayText = "";
        if (pluralPartRaw === null) { // No comma, plural info might be in nounPartWithDetails
            if (nounPartWithDetails.includes("(Sg.)")) pluralDisplayText = "(Singular only)";
            else if (nounPartWithDetails.includes("(Pl.)") || nounPartWithDetails.includes("(PL.)")) {
                pluralDisplayText = "(Plural only)";
            } else pluralDisplayText = "-"; // Default if no info
        } else { // Plural info came after a comma
            pluralDisplayText = pluralPartRaw;
            if (pluralDisplayText === "=") pluralDisplayText = "¨e"; // For Markt
        }

        // Handle OCR quote for umlaut
        if (pluralDisplayText && pluralDisplayText.startsWith('"')) {
            pluralDisplayText = "¨" + pluralDisplayText.substring(1);
        }
        // Specific OCR artifact corrections based on previous Python logic
        if (nounBase === "Haus" && pluralDisplayText === "er") pluralDisplayText = "¨er";
        else if (nounBase === "Rathaus" && pluralDisplayText === "er") pluralDisplayText = "¨er";
        else if (nounBase === "Konzerthaus" && pluralDisplayText === "er") pluralDisplayText = "¨er";
        else if (nounBase === "Fahrrad" && pluralDisplayText === "er") pluralDisplayText = "¨er"; // Note: OCR was "er", not ""er"
        else if (nounBase === "Apfel" && pluralDisplayText === "¨") pluralDisplayText = "¨"; // OCR "
        else if (nounBase === "Nacht" && pluralDisplayText === "e") pluralDisplayText = "¨e"; // OCR "e
        

        // Basic validation
        if (!nounBase || nounBase.toLowerCase() === nounBase || nounBase.split(' ').length > 3) continue;
        if (nounBase.includes('(') && !nounBase.includes(')')) continue; // Unclosed parenthesis
        if (nounBase.includes('...') || nounBase.includes('?')) continue; // Likely not a noun

        let fullInfoGerman = `${article} ${nounBase}`;
        if (pluralDisplayText && pluralDisplayText !== "(Singular only)" && pluralDisplayText !== "(Plural only)" && pluralDisplayText !== "-") {
            fullInfoGerman += `, Pl: ${pluralDisplayText}`;
        } else if (pluralDisplayText && (pluralDisplayText === "(Singular only)" || pluralDisplayText === "(Plural only)")) {
            fullInfoGerman += ` ${pluralDisplayText}`;
        } else if (pluralDisplayText === "-") {
             // Optionally add ", Pl: -" or just leave it if "-" means no change / not specified often
        }
        
        const englishMeaning = GERMAN_TO_ENGLISH[nounBase] || "Meaning not available";
        const emoji = NOUN_TO_EMOJI[nounBase] || "";

        flashcards.push({
            id: nounBase, // Use nounBase as a unique ID for the card
            front_display: nounPartWithDetails, 
            noun_base_for_lookup: nounBase,
            article: article,
            plural_form_raw: pluralDisplayText, // This will be used to construct the display plural
            full_info_german: fullInfoGerman,
            english_meaning: englishMeaning,
            emoji: emoji
        });
    }

    // Remove duplicates based on 'id' (noun_base_for_lookup)
    const uniqueFlashcards = [];
    const seenIds = new Set();
    for (const card of flashcards) {
        if (!seenIds.has(card.id)) {
            uniqueFlashcards.push(card);
            seenIds.add(card.id);
        }
    }
    // console.log("Parsed Flashcards:", uniqueFlashcards); // For debugging
    return uniqueFlashcards;
}

// This function will be called by script.js to get the processed flashcard data
function getFlashcardData() {
    return parseOcrToFlashcards(ocr_text);
}